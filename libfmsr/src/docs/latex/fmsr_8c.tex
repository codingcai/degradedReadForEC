\hypertarget{fmsr_8c}{\section{fmsr.\-c \-File \-Reference}
\label{fmsr_8c}\index{fmsr.\-c@{fmsr.\-c}}
}


\-Implements core libfmsr functions callable by third-\/party apps.  


{\ttfamily \#include $<$stdio.\-h$>$}\*
{\ttfamily \#include $<$stdlib.\-h$>$}\*
{\ttfamily \#include $<$string.\-h$>$}\*
{\ttfamily \#include \char`\"{}fmsr.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}fmsrutil.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}matrix.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}misc.\-h\char`\"{}}\*
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{fmsr_8c_ad9ee7e044ebaae2f8ae88612264a182a}{\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}~1000000000
\begin{DoxyCompactList}\small\item\em \-Number of rounds to check in the two-\/phase checking during repair before declaring failure. \end{DoxyCompactList}\item 
\#define \hyperlink{fmsr_8c_aa431ce34dace4479417fd8668b6a5c23}{\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}~512
\begin{DoxyCompactList}\small\item\em \-Number of rounds to try regenerating new chunks by heuristic coefficient generation instead of fully random coefficients. \end{DoxyCompactList}\item 
\#define \hyperlink{fmsr_8c_ae2151f25f95449931d98f7187387a6a0}{\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S}~1
\begin{DoxyCompactList}\small\item\em \-Check er\-M\-D\-S property? 1 (yes) or 0 (no) \end{DoxyCompactList}\item 
\#define \hyperlink{fmsr_8c_a032bd757402d25c2c8f1d1d35d061f51}{\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S}~0
\begin{DoxyCompactList}\small\item\em \-Check \-M\-D\-S property? 1 (yes) or 0 (no) \end{DoxyCompactList}\item 
\#define \hyperlink{fmsr_8c_a0bfe65e370c4e8a23630d31ad0007ee5}{\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S}~0
\begin{DoxyCompactList}\small\item\em \-Check r\-M\-D\-S property? 1 (yes) or 0 (no); \-Note\-: \-If yes, \-C\-H\-E\-C\-K\-\_\-\-M\-D\-S must be 1 as well. \end{DoxyCompactList}\item 
\#define \hyperlink{fmsr_8c_ad8ba90b2d681fcfbc6cde44271ad6519}{\-N\-U\-M\-\_\-\-T}~7
\begin{DoxyCompactList}\small\item\em \-Number of threads to distribute \hyperlink{matrix_8c_a2451f2278d5ad63b49c86336a618c4f1}{matrix\-\_\-mul()} on. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{fmsr_8c_a743ddc67c1ab8369c6baa8d226a623a0}{fmsr\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em \-Must be called first before using any core functions in the library. \end{DoxyCompactList}\item 
\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} \hyperlink{fmsr_8c_af9107c40b552212738f90c59068a2d63}{fmsr\-\_\-nodeid} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} index)
\begin{DoxyCompactList}\small\item\em \-Returns id of the node where the index-\/th chunk resides, or 255 on failure. \end{DoxyCompactList}\item 
\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} \hyperlink{fmsr_8c_af87674560823ce0b89a73a2c2d50f209}{fmsr\-\_\-chunks\-\_\-per\-\_\-node} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n)
\begin{DoxyCompactList}\small\item\em \-Returns the number of chunks per node, or 255 on failure. \end{DoxyCompactList}\item 
\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} \hyperlink{fmsr_8c_a891d7d17dd04e847fe07bfd1ddd9f3e3}{fmsr\-\_\-chunks\-\_\-on\-\_\-node} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} node, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$chunk\-\_\-indices)
\begin{DoxyCompactList}\small\item\em \-Returns the indices of chunks on a certain node through chunk\-\_\-indices, or 255 on failure. \end{DoxyCompactList}\item 
\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} \hyperlink{fmsr_8c_a9c8cb79d6a92430ef24d90af13530499}{fmsr\-\_\-nn} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n)
\begin{DoxyCompactList}\small\item\em \-Returns the number of native chunks. \end{DoxyCompactList}\item 
\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} \hyperlink{fmsr_8c_a311bed5bb7d417632eecd175e23cd448}{fmsr\-\_\-nc} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n)
\begin{DoxyCompactList}\small\item\em \-Returns the number of code chunks. \end{DoxyCompactList}\item 
size\-\_\-t \hyperlink{fmsr_8c_a7e923e0eef4d32dbdfd77de7bf5ddd90}{fmsr\-\_\-padded\-\_\-size} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em \-Returns the size of input file after being padded. \end{DoxyCompactList}\item 
int \hyperlink{fmsr_8c_a58e70b421387bd44f0a320cc1285e25f}{fmsr\-\_\-encode} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$data, size\-\_\-t data\-\_\-size, int create\-\_\-new, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$code\-\_\-chunks, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$encode\-\_\-matrix)
\begin{DoxyCompactList}\small\item\em \-Splits file into native chunks and encodes into code chunks. \end{DoxyCompactList}\item 
int \hyperlink{fmsr_8c_ad0f82cd90954b5a3cbeb14e16e761b73}{fmsr\-\_\-decode} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$code\-\_\-chunks, size\-\_\-t chunk\-\_\-size, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$chunk\-\_\-indices, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} num\-\_\-chunks, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$encode\-\_\-matrix, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$decode\-\_\-matrix, int create\-\_\-new, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$data, size\-\_\-t $\ast$data\-\_\-size)
\begin{DoxyCompactList}\small\item\em \-Decodes code chunks to give the original data. \end{DoxyCompactList}\item 
int \hyperlink{fmsr_8c_aba1540735cbbc0b921f8b0e6df977478}{fmsr\-\_\-repair} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} k, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} n, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$encode\-\_\-matrix, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$erasures, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} num\-\_\-erasures, \hyperlink{structfmsr__repair__hints}{fmsr\-\_\-repair\-\_\-hints} $\ast$hints, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$new\-\_\-encode\-\_\-matrix, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$repair\-\_\-matrix, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$chunks\-\_\-to\-\_\-retrieve, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$num\-\_\-chunks\-\_\-to\-\_\-retrieve)
\begin{DoxyCompactList}\small\item\em \-Informs caller of the chunks and encoding matrix used in repair. \end{DoxyCompactList}\item 
void \hyperlink{fmsr_8c_a523a942fd3f3ca6dcf7be2efc77c4a10}{fmsr\-\_\-regenerate} (\hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$repair\-\_\-matrix, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} rows, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} cols, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$retrieved\-\_\-chunks, size\-\_\-t chunk\-\_\-size, \hyperlink{gf_8h_a339b4ec591f7b3fed03e4be7c9482508}{gf} $\ast$new\-\_\-code\-\_\-chunks)
\begin{DoxyCompactList}\small\item\em \-Generates new code\-\_\-chunks from existing code\-\_\-chunks. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-Implements core libfmsr functions callable by third-\/party apps. \begin{DoxyAuthor}{\-Author}
\-Henry \-Chen (\href{mailto:chchen@cse.cuhk.edu.hk}{\tt chchen@cse.\-cuhk.\-edu.\-hk}) 
\end{DoxyAuthor}


\subsection{\-Define \-Documentation}
\hypertarget{fmsr_8c_ae2151f25f95449931d98f7187387a6a0}{\index{fmsr.\-c@{fmsr.\-c}!\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S}}
\index{\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-C\-H\-E\-C\-K\-\_\-\-E\-R\-M\-D\-S}~1}}\label{fmsr_8c_ae2151f25f95449931d98f7187387a6a0}


\-Check er\-M\-D\-S property? 1 (yes) or 0 (no) 

\hypertarget{fmsr_8c_a032bd757402d25c2c8f1d1d35d061f51}{\index{fmsr.\-c@{fmsr.\-c}!\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S}}
\index{\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-C\-H\-E\-C\-K\-\_\-\-M\-D\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-C\-H\-E\-C\-K\-\_\-\-M\-D\-S}~0}}\label{fmsr_8c_a032bd757402d25c2c8f1d1d35d061f51}


\-Check \-M\-D\-S property? 1 (yes) or 0 (no) 

\hypertarget{fmsr_8c_a0bfe65e370c4e8a23630d31ad0007ee5}{\index{fmsr.\-c@{fmsr.\-c}!\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S}}
\index{\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S@{\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-C\-H\-E\-C\-K\-\_\-\-R\-M\-D\-S}~0}}\label{fmsr_8c_a0bfe65e370c4e8a23630d31ad0007ee5}


\-Check r\-M\-D\-S property? 1 (yes) or 0 (no); \-Note\-: \-If yes, \-C\-H\-E\-C\-K\-\_\-\-M\-D\-S must be 1 as well. 

\hypertarget{fmsr_8c_aa431ce34dace4479417fd8668b6a5c23}{\index{fmsr.\-c@{fmsr.\-c}!\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D@{\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}}
\index{\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D@{\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-L\-A\-Z\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}~512}}\label{fmsr_8c_aa431ce34dace4479417fd8668b6a5c23}


\-Number of rounds to try regenerating new chunks by heuristic coefficient generation instead of fully random coefficients. 

\hypertarget{fmsr_8c_ad9ee7e044ebaae2f8ae88612264a182a}{\index{fmsr.\-c@{fmsr.\-c}!\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D@{\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}}
\index{\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D@{\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-N\-U\-M\-\_\-\-C\-H\-E\-C\-K\-S\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}~1000000000}}\label{fmsr_8c_ad9ee7e044ebaae2f8ae88612264a182a}


\-Number of rounds to check in the two-\/phase checking during repair before declaring failure. 

\hypertarget{fmsr_8c_ad8ba90b2d681fcfbc6cde44271ad6519}{\index{fmsr.\-c@{fmsr.\-c}!\-N\-U\-M\-\_\-\-T@{\-N\-U\-M\-\_\-\-T}}
\index{\-N\-U\-M\-\_\-\-T@{\-N\-U\-M\-\_\-\-T}!fmsr.c@{fmsr.\-c}}
\subsubsection[{\-N\-U\-M\-\_\-\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-N\-U\-M\-\_\-\-T}~7}}\label{fmsr_8c_ad8ba90b2d681fcfbc6cde44271ad6519}


\-Number of threads to distribute \hyperlink{matrix_8c_a2451f2278d5ad63b49c86336a618c4f1}{matrix\-\_\-mul()} on. 



\subsection{\-Function \-Documentation}
\hypertarget{fmsr_8c_a891d7d17dd04e847fe07bfd1ddd9f3e3}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-chunks\-\_\-on\-\_\-node@{fmsr\-\_\-chunks\-\_\-on\-\_\-node}}
\index{fmsr\-\_\-chunks\-\_\-on\-\_\-node@{fmsr\-\_\-chunks\-\_\-on\-\_\-node}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-chunks\-\_\-on\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}{\bf gf} {\bf fmsr\-\_\-chunks\-\_\-on\-\_\-node} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{{\bf gf}}]{node, }
\item[{{\bf gf} $\ast$}]{chunk\-\_\-indices}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a891d7d17dd04e847fe07bfd1ddd9f3e3}


\-Returns the indices of chunks on a certain node through chunk\-\_\-indices, or 255 on failure. 

\hypertarget{fmsr_8c_af87674560823ce0b89a73a2c2d50f209}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-chunks\-\_\-per\-\_\-node@{fmsr\-\_\-chunks\-\_\-per\-\_\-node}}
\index{fmsr\-\_\-chunks\-\_\-per\-\_\-node@{fmsr\-\_\-chunks\-\_\-per\-\_\-node}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-chunks\-\_\-per\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}{\bf gf} {\bf fmsr\-\_\-chunks\-\_\-per\-\_\-node} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_af87674560823ce0b89a73a2c2d50f209}


\-Returns the number of chunks per node, or 255 on failure. 

\hypertarget{fmsr_8c_ad0f82cd90954b5a3cbeb14e16e761b73}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-decode@{fmsr\-\_\-decode}}
\index{fmsr\-\_\-decode@{fmsr\-\_\-decode}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-decode}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf fmsr\-\_\-decode} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{{\bf gf} $\ast$}]{code\-\_\-chunks, }
\item[{size\-\_\-t}]{chunk\-\_\-size, }
\item[{{\bf gf} $\ast$}]{chunk\-\_\-indices, }
\item[{{\bf gf}}]{num\-\_\-chunks, }
\item[{{\bf gf} $\ast$}]{encode\-\_\-matrix, }
\item[{{\bf gf} $\ast$}]{decode\-\_\-matrix, }
\item[{int}]{create\-\_\-new, }
\item[{{\bf gf} $\ast$}]{data, }
\item[{size\-\_\-t $\ast$}]{data\-\_\-size}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_ad0f82cd90954b5a3cbeb14e16e761b73}


\-Decodes code chunks to give the original data. 


\begin{DoxyParams}[1]{\-Parameters}
\mbox{\tt in}  & {\em k,n} & (n,k)-\/\-F\-M\-S\-R \\
\hline
\mbox{\tt in}  & {\em code\-\_\-chunks} & retrieved code chunks \\
\hline
\mbox{\tt in}  & {\em chunk\-\_\-size} & size of each code chunk \\
\hline
\mbox{\tt in}  & {\em chunk\-\_\-indices} & indices of retrieved chunks \\
\hline
\mbox{\tt in}  & {\em num\-\_\-chunks} & number of chunks retrieved \\
\hline
\mbox{\tt in}  & {\em encode\-\_\-matrix} & original encoding matrix (can be \-N\-U\-L\-L if decode\-\_\-matrix is already supplied) \\
\hline
\mbox{\tt in,out}  & {\em decode\-\_\-matrix} & decoding matrix (can be \-N\-U\-L\-L if not interested) \\
\hline
\mbox{\tt in}  & {\em create\-\_\-new} & if 0, use supplied decode\-\_\-matrix; else calculate and update decode\-\_\-matrix \\
\hline
\mbox{\tt out}  & {\em data} & decoded data (concat native chunks and unpad) \\
\hline
\mbox{\tt out}  & {\em data\-\_\-size} & size of decoded data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
0 on success; -\/1 on failure 
\end{DoxyReturn}
\hypertarget{fmsr_8c_a58e70b421387bd44f0a320cc1285e25f}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-encode@{fmsr\-\_\-encode}}
\index{fmsr\-\_\-encode@{fmsr\-\_\-encode}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-encode}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf fmsr\-\_\-encode} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{{\bf gf} $\ast$}]{data, }
\item[{size\-\_\-t}]{data\-\_\-size, }
\item[{int}]{create\-\_\-new, }
\item[{{\bf gf} $\ast$}]{code\-\_\-chunks, }
\item[{{\bf gf} $\ast$}]{encode\-\_\-matrix}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a58e70b421387bd44f0a320cc1285e25f}


\-Splits file into native chunks and encodes into code chunks. 

\-Note\-: sufficient memory should be allocated for the padded data (using \hyperlink{fmsr_8c_a7e923e0eef4d32dbdfd77de7bf5ddd90}{fmsr\-\_\-padded\-\_\-size()}), which is longer than data\-\_\-size.


\begin{DoxyParams}[1]{\-Parameters}
\mbox{\tt in}  & {\em k,n} & (n,k)-\/\-F\-M\-S\-R \\
\hline
\mbox{\tt in}  & {\em data} & original unpadded file to be encoded \\
\hline
\mbox{\tt in}  & {\em data\-\_\-size} & unpadded file size \\
\hline
\mbox{\tt in}  & {\em create\-\_\-new} & if 0, use supplied encode\-\_\-matrix; else generate and update encode\-\_\-matrix \\
\hline
\mbox{\tt out}  & {\em code\-\_\-chunks} & code chunks from encoded data \\
\hline
\mbox{\tt in,out}  & {\em encode\-\_\-matrix} & encoding matrix\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
0 on success; -\/1 on failure 
\end{DoxyReturn}
\hypertarget{fmsr_8c_a743ddc67c1ab8369c6baa8d226a623a0}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-init@{fmsr\-\_\-init}}
\index{fmsr\-\_\-init@{fmsr\-\_\-init}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf fmsr\-\_\-init} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a743ddc67c1ab8369c6baa8d226a623a0}


\-Must be called first before using any core functions in the library. 

\hypertarget{fmsr_8c_a311bed5bb7d417632eecd175e23cd448}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-nc@{fmsr\-\_\-nc}}
\index{fmsr\-\_\-nc@{fmsr\-\_\-nc}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-nc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf gf} {\bf fmsr\-\_\-nc} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a311bed5bb7d417632eecd175e23cd448}


\-Returns the number of code chunks. 

\hypertarget{fmsr_8c_a9c8cb79d6a92430ef24d90af13530499}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-nn@{fmsr\-\_\-nn}}
\index{fmsr\-\_\-nn@{fmsr\-\_\-nn}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-nn}]{\setlength{\rightskip}{0pt plus 5cm}{\bf gf} {\bf fmsr\-\_\-nn} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a9c8cb79d6a92430ef24d90af13530499}


\-Returns the number of native chunks. 

\hypertarget{fmsr_8c_af9107c40b552212738f90c59068a2d63}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-nodeid@{fmsr\-\_\-nodeid}}
\index{fmsr\-\_\-nodeid@{fmsr\-\_\-nodeid}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-nodeid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf gf} {\bf fmsr\-\_\-nodeid} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{{\bf gf}}]{index}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_af9107c40b552212738f90c59068a2d63}


\-Returns id of the node where the index-\/th chunk resides, or 255 on failure. 

\hypertarget{fmsr_8c_a7e923e0eef4d32dbdfd77de7bf5ddd90}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-padded\-\_\-size@{fmsr\-\_\-padded\-\_\-size}}
\index{fmsr\-\_\-padded\-\_\-size@{fmsr\-\_\-padded\-\_\-size}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-padded\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}size\-\_\-t {\bf fmsr\-\_\-padded\-\_\-size} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a7e923e0eef4d32dbdfd77de7bf5ddd90}


\-Returns the size of input file after being padded. 

\hypertarget{fmsr_8c_a523a942fd3f3ca6dcf7be2efc77c4a10}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-regenerate@{fmsr\-\_\-regenerate}}
\index{fmsr\-\_\-regenerate@{fmsr\-\_\-regenerate}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-regenerate}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf fmsr\-\_\-regenerate} (
\begin{DoxyParamCaption}
\item[{{\bf gf} $\ast$}]{repair\-\_\-matrix, }
\item[{{\bf gf}}]{rows, }
\item[{{\bf gf}}]{cols, }
\item[{{\bf gf} $\ast$}]{retrieved\-\_\-chunks, }
\item[{size\-\_\-t}]{chunk\-\_\-size, }
\item[{{\bf gf} $\ast$}]{new\-\_\-code\-\_\-chunks}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_a523a942fd3f3ca6dcf7be2efc77c4a10}


\-Generates new code\-\_\-chunks from existing code\-\_\-chunks. 

\-This is simply a single matrix multiplication that should be called after \hyperlink{fmsr_8c_aba1540735cbbc0b921f8b0e6df977478}{fmsr\-\_\-repair()}.


\begin{DoxyParams}[1]{\-Parameters}
\mbox{\tt in}  & {\em repair\-\_\-matrix} & repair matrix obtained from \hyperlink{fmsr_8c_aba1540735cbbc0b921f8b0e6df977478}{fmsr\-\_\-repair()} \\
\hline
\mbox{\tt in}  & {\em rows,cols} & number of rows and columns in repair\-\_\-matrix \\
\hline
\mbox{\tt in}  & {\em retrieved\-\_\-chunks} & all code chunks retrieved for the repair \\
\hline
\mbox{\tt in}  & {\em chunk\-\_\-size} & size of each code chunk \\
\hline
\mbox{\tt out}  & {\em new\-\_\-code\-\_\-chunks} & all code chunks newly generated by this function \\
\hline
\end{DoxyParams}
\hypertarget{fmsr_8c_aba1540735cbbc0b921f8b0e6df977478}{\index{fmsr.\-c@{fmsr.\-c}!fmsr\-\_\-repair@{fmsr\-\_\-repair}}
\index{fmsr\-\_\-repair@{fmsr\-\_\-repair}!fmsr.c@{fmsr.\-c}}
\subsubsection[{fmsr\-\_\-repair}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf fmsr\-\_\-repair} (
\begin{DoxyParamCaption}
\item[{{\bf gf}}]{k, }
\item[{{\bf gf}}]{n, }
\item[{{\bf gf} $\ast$}]{encode\-\_\-matrix, }
\item[{{\bf gf} $\ast$}]{erasures, }
\item[{{\bf gf}}]{num\-\_\-erasures, }
\item[{{\bf fmsr\-\_\-repair\-\_\-hints} $\ast$}]{hints, }
\item[{{\bf gf} $\ast$}]{new\-\_\-encode\-\_\-matrix, }
\item[{{\bf gf} $\ast$}]{repair\-\_\-matrix, }
\item[{{\bf gf} $\ast$}]{chunks\-\_\-to\-\_\-retrieve, }
\item[{{\bf gf} $\ast$}]{num\-\_\-chunks\-\_\-to\-\_\-retrieve}
\end{DoxyParamCaption}
)}}\label{fmsr_8c_aba1540735cbbc0b921f8b0e6df977478}


\-Informs caller of the chunks and encoding matrix used in repair. 

\-Most of the work during repair is done here.


\begin{DoxyParams}[1]{\-Parameters}
\mbox{\tt in}  & {\em k,n} & (n,k)-\/\-F\-M\-S\-R \\
\hline
\mbox{\tt in}  & {\em encode\-\_\-matrix} & current encoding matrix before repair \\
\hline
\mbox{\tt in}  & {\em erasures} & list of failed node indices \\
\hline
\mbox{\tt in}  & {\em num\-\_\-erasures} & number of failed nodes \\
\hline
\mbox{\tt in}  & {\em hints} & refer to struct \hyperlink{structfmsr__repair__hints}{fmsr\-\_\-repair\-\_\-hints} \\
\hline
\mbox{\tt out}  & {\em new\-\_\-encode\-\_\-matrix} & new encoding matrix after repair \\
\hline
\mbox{\tt out}  & {\em repair\-\_\-matrix} & repair matrix (follows order given by chunk list below) \\
\hline
\mbox{\tt out}  & {\em chunks\-\_\-to\-\_\-retrieve} & list of code chunks to retrieve from surviving nodes \\
\hline
\mbox{\tt out}  & {\em num\-\_\-chunks\-\_\-to\-\_\-retrieve} & number of code chunks to retrieve\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
number of rounds checked on success ($>$0); -\/1 on unsupported parameters; 

0 on failing to generate suitable coefficients 
\end{DoxyReturn}
